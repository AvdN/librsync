name: Lint

on: [push, pull_request]

jobs:
  lint:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Install Dependencies
      # Unfortunately available Marketplace Actions for this are in a mess, so we do it manually.
      run: |
        sudo apt-get update -y
        sudo apt-get install -y libpopt-dev libb2-dev clang-tidy libclang-dev llvm-dev iwyu

    - name: Configure CMake
      run: cmake .

    - name: clang-tidy
      run: cmake --build . --target clang-tidy

    - name: iwyu
      run: |
        iwyu  -E -xc - -v </dev/null
        cmake --build . --target iwyu
